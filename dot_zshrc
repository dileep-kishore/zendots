# vim:ft=zsh

setopt INC_APPEND_HISTORY SHARE_HISTORY
setopt APPEND_HISTORY
# unsetopt BG_NICE
setopt CORRECT
setopt EXTENDED_HISTORY
# setopt MENU_COMPLETE
# setopt ALL_EXPORT
setopt RM_STAR_WAIT

setopt   notify globdots correct pushdtohome cdablevars autolist
setopt   correctall autocd recexact longlistjobs interactivecomments
setopt   autoresume histignoredups pushdsilent
setopt   autopushd pushdminus extendedglob rcquotes mailwarning
unsetopt bgnice autoparamslash

autoload -Uz compinit
compinit

# Variables
export EDITOR=nvim
export USE_EDITOR=$EDITOR
export VISUAL=$EDITOR
export BROWSER=brave-browser
export GIT_PAGER="delta"
export FZF_DEFAULT_OPTS="\
    --height 40% --reverse --preview 'bat --style=numbers --color=always --line-range :500 {}'\
    --color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 \
    --color=fg:#cdd6f4,header:#f38ba8,info:#cba6f7,pointer:#f5e0dc \
    --color=marker:#f5e0dc,fg+:#cdd6f4,prompt:#cba6f7,hl+:#f38ba8"

export PATH=$PATH:~/.local/bin
export PATH="$PATH:/var/lib/flatpak/exports/bin"
export PATH="$PATH:~/npm-global/bin"

### Added by Zinit's installer
if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
    print -P "%F{33} %F{220}Installing %F{33}ZDHARMA-CONTINUUM%F{220} Initiative Plugin Manager (%F{33}zdharma-continuum/zinit%F{220})â€¦%f"
    command mkdir -p "$HOME/.local/share/zinit" && command chmod g-rwX "$HOME/.local/share/zinit"
    command git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" && \
        print -P "%F{33} %F{34}Installation successful.%f%b" || \
        print -P "%F{160} The clone has failed.%f%b"
fi

source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# Load a few important annexes, without Turbo
# (this is currently required for annexes)
zinit light-mode for \
    zdharma-continuum/zinit-annex-as-monitor \
    zdharma-continuum/zinit-annex-bin-gem-node \
    zdharma-continuum/zinit-annex-patch-dl \
    zdharma-continuum/zinit-annex-rust

# Plugins

# important libraries
zinit lucid for \
    OMZL::clipboard.zsh \
    OMZL::compfix.zsh \
    OMZL::history.zsh \
    OMZL::spectrum.zsh

# important plugins
zinit ice depth=1
zinit light jeffreytse/zsh-vi-mode
zinit light djui/alias-tips
zinit load wfxr/forgit

zinit wait lucid for \
    OMZP::asdf \
    OMZP::aliases \
    OMZP::copypath \
    OMZP::colored-man-pages \
    OMZP::direnv \
    OMZP::extract \
    OMZP::magic-enter \
    OMZP::npm \
    OMZP::python \
    OMZP::tmux \
    OMZP::web-search

zinit wait lucid for \
 atinit"ZINIT[COMPINIT_OPTS]=-C; zpcompinit; zpcdreplay" \
    zdharma-continuum/fast-syntax-highlighting \
 atload"_zsh_autosuggest_start; bindkey '^ ' autosuggest-accept" \
    zsh-users/zsh-autosuggestions \
 blockf atpull'zinit creinstall -q .' \
    zsh-users/zsh-completions

zinit ice as"command" from"gh-r" bpick"atuin-*.tar.gz" mv"atuin*/atuin -> atuin" \
    atclone"./atuin init zsh > init.zsh; ./atuin gen-completions --shell zsh > _atuin" \
    atpull"%atclone" src"init.zsh"
zinit light atuinsh/atuin

### End of Zinit's installer chunk

eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
eval "$(zoxide init --cmd cd zsh)"
eval "$(atuin init zsh)"
eval "$(tv init zsh)"

# carapace
setopt menucomplete
export LS_COLORS=$(vivid generate catppuccin-mocha)
zstyle ':completion:*' menu select
export CARAPACE_BRIDGES='zsh,fish,bash,inshellisense' # optional
zstyle ':completion:*' format $'\e[2;37mCompleting %d\e[m'
zstyle ':completion:*' list-colors $LS_COLORS
source <(carapace _carapace)

# aliases
alias bat="bat --theme='Catppuccin Mocha' --style='numbers,changes,header'"
alias y="yazi"
alias ls="eza --icons"
alias lg="lazygit"
alias gst="git status --short"
alias du="dua i"
alias vimipython="ipython --TerminalInteractiveShell.editing_mode=vi"
alias grep="grep --color=auto"
alias psgrep="ps aux | grep -v grep | grep -i -e VSZ -e"
alias df="df -ahiT --total"
alias clear="clear -x"
alias rm="rm -i"
alias cls="clear"
alias exportforge="export PATH=$HOME/miniforge3/bin:$PATH"
alias myip="curl http://ipecho.net/plain; echo"

# Tmux
alias ta="sesh connect"
alias tdetach="tmux detach"
alias tkill="tmux kill-session -t"
alias tlist="sesh list -tT --icons"
tnew() {
    bash ~/.config/tmux/scripts/templater.sh "$@"
    tmuxinator start "$1"
}

# AI secrets
export OPENAI_API_KEY="$(cat ~/.secrets/openai.txt)"
export ANTHROPIC_API_KEY="$(cat ~/.secrets/anthropic.txt)"
export GEMINI_API_KEY="$(cat ~/.secrets/gemini.txt)"
export TAVILY_API_KEY="$(cat ~/.secrets/tavily.txt)"

# prompt
eval "$(starship init zsh)"
